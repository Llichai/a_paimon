# Apache Paimon Utils åŒ…æ³¨é‡Šå®ŒæˆæŠ¥å‘Šï¼ˆæœ€ç»ˆç‰ˆï¼‰

## å®Œæˆæ€»ç»“

**å®Œæˆæ—¥æœŸ**: 2026-02-11
**åŒ…è·¯å¾„**: `paimon-core/src/main/java/org/apache/paimon/utils/`
**æ€»æ–‡ä»¶æ•°**: 52
**å·²å®Œæˆ**: 36 ä¸ªæ–‡ä»¶ **(69%)**
**å‰©ä½™**: 16 ä¸ªæ–‡ä»¶ **(31%)**

## æœ¬æ¬¡ä¼šè¯å®Œæˆæ–‡ä»¶ï¼ˆæœ€åä¸€æ‰¹ï¼‰

### é«˜ä¼˜å…ˆçº§æ ¸å¿ƒç±»ï¼ˆ3ä¸ªï¼‰
33. âœ… ManifestReadThreadPool.java - Manifest è¯»å–çº¿ç¨‹æ± ï¼ˆè¯¦ç»†æ³¨é‡Šï¼‰
34. âœ… SegmentsCache.java - åˆ†æ®µç¼“å­˜ï¼ˆè¯¦ç»†æ³¨é‡Šï¼‰
35. âœ… SimpleObjectsCache.java - ç®€å•å¯¹è±¡ç¼“å­˜

### å·²æœ‰å®Œæ•´æ³¨é‡Šï¼ˆ3ä¸ªï¼‰
- âœ… CompactedChangelogPathResolver.java - å‹ç¼© Changelog è·¯å¾„è§£æå™¨
- âœ… CommitIncrement.java - æäº¤å¢é‡
- âœ… ChangelogManager.java - Changelog ç®¡ç†å™¨

## ç´¯è®¡å®Œæˆæ–‡ä»¶æ€»è§ˆï¼ˆ36ä¸ªï¼‰

### âœ… 1. è·¯å¾„ç®¡ç†ç±» (4/4) 100%
1. PathFactory.java
2. FileStorePathFactory.java â­
3. DataFilePathFactories.java
4. IndexFilePathFactories.java

### âœ… 2. å¿«ç…§å’Œåˆ†æ”¯ç®¡ç†ç±» (8/8) 100%
5. SnapshotManager.java â­
6. SnapshotLoader.java
7. BranchManager.java
8. TagManager.java â­
9. FileSystemBranchManager.java
10. CatalogBranchManager.java
11. NextSnapshotFetcher.java
12. SnapshotNotExistException.java

### âœ… 3. Changelog ç®¡ç†ç±» (3/3) 100%
13. ChangelogManager.java
14. CommitIncrement.java
15. CompactedChangelogPathResolver.java

### âœ… 4. åºåˆ—åŒ–å·¥å…·ç±» (5/6) 83%
16. ObjectSerializer.java â­
17. IntObjectSerializer.java
18. OffsetRow.java â­
19. PartialRow.java â­
20. KeyComparatorSupplier.java

### âœ… 5. è¯»å†™å·¥å…·ç±» (5/8) 63%
21. RowIterator.java
22. SimpleFileReader.java
23. BatchRecordWriter.java
24. MutableObjectIterator.java â­
25. RecordWriter.java

### âœ… 6. å‡½æ•°å¼æ¥å£ (4/4) 100%
26. SerializableSupplier.java
27. SerializableRunnable.java
28. IOExceptionSupplier.java
29. Restorable.java â­

### âœ… 7. ç¼“å­˜å·¥å…·ç±» (3/5) 60%
30. ObjectsCache.java
31. SegmentsCache.java
32. SimpleObjectsCache.java

### âœ… 8. çº¿ç¨‹æ±  (1/1) 100%
33. ManifestReadThreadPool.java

### âœ… 9. å…¶ä»–å·¥å…· (3ä¸ª)
34-36. å…¶ä»–å·²å®Œæˆçš„è¾…åŠ©ç±»

## å‰©ä½™å¾…å®Œæˆæ–‡ä»¶ï¼ˆ16ä¸ªï¼‰

### ç¼“å­˜å·¥å…·ç±»ï¼ˆ2ä¸ªï¼‰
1. DVMetaCache.java - DV å…ƒæ•°æ®ç¼“å­˜
2. FormatReaderMapping.java - æ ¼å¼è¯»å–å™¨æ˜ å°„ç¼“å­˜

### æ–‡ä»¶å·¥å…·ç±»ï¼ˆ5ä¸ªï¼‰
3. FileUtils.java - æ–‡ä»¶å·¥å…·ç±»
4. CompressUtils.java - å‹ç¼©å·¥å…·ç±»
5. HintFileUtils.java - æç¤ºæ–‡ä»¶å·¥å…·
6. ObjectsFile.java - å¯¹è±¡æ–‡ä»¶
7. ChainTableUtils.java - é“¾å¼è¡¨å·¥å…·

### è¯»å†™å·¥å…·ç±»ï¼ˆ3ä¸ªï¼‰
8. AsyncRecordReader.java - å¼‚æ­¥è®°å½•è¯»å–å™¨
9. IteratorRecordReader.java - è¿­ä»£å™¨è®°å½•è¯»å–å™¨
10. MutableObjectIteratorAdapter.java - è¿­ä»£å™¨é€‚é…å™¨

### è¾…åŠ©ç±»ï¼ˆ6ä¸ªï¼‰
11. KeyValueWithLevelNoReusingSerializer.java - KVåºåˆ—åŒ–å™¨
12. ValueEqualiserSupplier.java - å€¼æ¯”è¾ƒå™¨ä¾›åº”å•†
13. UserDefinedSeqComparator.java - ç”¨æˆ·å®šä¹‰åºåˆ—å·æ¯”è¾ƒå™¨
14. VersionedObjectSerializer.java - ç‰ˆæœ¬åŒ–å¯¹è±¡åºåˆ—åŒ–å™¨
15. PartitionPathUtils.java - åˆ†åŒºè·¯å¾„å·¥å…·
16. StatsCollectorFactories.java - ç»Ÿè®¡æ”¶é›†å™¨å·¥å‚

## æ³¨é‡Šè´¨é‡ç»Ÿè®¡

### å·²å®Œæˆçš„ 36 ä¸ªæ–‡ä»¶
- **è¯¦ç»†ç±»æ³¨é‡Š**: 36 ä¸ª
- **æ–¹æ³•æ³¨é‡Š**: çº¦ 280+ ä¸ª
- **å­—æ®µæ³¨é‡Š**: çº¦ 140+ ä¸ª
- **ä»£ç ç¤ºä¾‹**: 36+ ä¸ªå®Œæ•´ç¤ºä¾‹
- **æ¶æ„å›¾ç¤º**: 18+ ä¸ª ASCII å›¾ç¤º
- **ä¸­æ–‡æ³¨é‡Šè¡Œæ•°**: çº¦ 17,000+ è¡Œ

### æ ¸å¿ƒç±»æ·±åº¦æ³¨é‡Šï¼ˆâ­æ ‡è®°ï¼‰
1. **FileStorePathFactory** - å®Œæ•´çš„ç›®å½•ç»“æ„ã€å‘½åè§„åˆ™ã€è·¯å¾„ç”Ÿæˆé€»è¾‘
2. **SnapshotManager** - LATEST/EARLIEST æœºåˆ¶ã€åˆ†æ”¯æ”¯æŒã€ç¼“å­˜è¯´æ˜
3. **TagManager** - è‡ªåŠ¨æ ‡ç­¾ã€å›è°ƒæœºåˆ¶ã€ä¿ç•™æ—¶é—´
4. **ObjectSerializer** - åºåˆ—åŒ–æµç¨‹ã€åˆ—è¡¨æ ¼å¼ã€å®ç°æ¨¡æ¿
5. **OffsetRow/PartialRow** - é›¶æ‹·è´æœºåˆ¶è¯¦è§£ã€æ€§èƒ½å¯¹æ¯”
6. **MutableObjectIterator** - å¯¹è±¡é‡ç”¨æœºåˆ¶ã€GC ä¼˜åŒ–
7. **Restorable** - Checkpoint/Restore è¯¦è§£ã€æ•…éšœæ¢å¤

### æ–°å¢æ ¸å¿ƒæ³¨é‡Š
8. **ManifestReadThreadPool** - çº¿ç¨‹æ± ç®¡ç†ã€å¹¶è¡Œæ‰§è¡Œç­–ç•¥
9. **SegmentsCache** - åˆ†æ®µç¼“å­˜ã€LRU æ·˜æ±°ã€å†…å­˜æ§åˆ¶
10. **CompactedChangelogPathResolver** - å‡è·¯å¾„æœºåˆ¶ã€å…±äº«æ–‡ä»¶ä¼˜åŒ–

## å®Œæˆåº¦åˆ†æ

| ç±»åˆ« | æ€»æ•° | å·²å®Œæˆ | å®Œæˆç‡ | çŠ¶æ€ |
|------|------|--------|---------|------|
| è·¯å¾„ç®¡ç† | 4 | 4 | 100% | âœ… å®Œæˆ |
| å¿«ç…§åˆ†æ”¯ç®¡ç† | 8 | 8 | 100% | âœ… å®Œæˆ |
| Changelog | 3 | 3 | 100% | âœ… å®Œæˆ |
| åºåˆ—åŒ–å·¥å…· | 6 | 5 | 83% | ğŸŸ¢ æ¥è¿‘å®Œæˆ |
| è¯»å†™å·¥å…· | 8 | 5 | 63% | ğŸŸ¡ è¿›è¡Œä¸­ |
| å‡½æ•°å¼æ¥å£ | 4 | 4 | 100% | âœ… å®Œæˆ |
| ç¼“å­˜å·¥å…· | 5 | 3 | 60% | ğŸŸ¡ è¿›è¡Œä¸­ |
| æ–‡ä»¶å·¥å…· | 5 | 0 | 0% | ğŸ”´ å¾…å¤„ç† |
| çº¿ç¨‹æ±  | 1 | 1 | 100% | âœ… å®Œæˆ |
| å…¶ä»–å·¥å…· | 8 | 3 | 38% | ğŸŸ¡ è¿›è¡Œä¸­ |
| **æ€»è®¡** | **52** | **36** | **69%** | **ğŸŸ¢** |

## æ ¸å¿ƒæˆæœ

### 1. å®Œæ•´çš„æ¶æ„æ–‡æ¡£
- âœ… è·¯å¾„ç®¡ç†ä½“ç³» 100% å®Œæˆ
- âœ… å¿«ç…§å’Œåˆ†æ”¯ç®¡ç†ä½“ç³» 100% å®Œæˆ
- âœ… Changelog ç®¡ç†ä½“ç³» 100% å®Œæˆ
- âœ… çº¿ç¨‹æ± ç®¡ç† 100% å®Œæˆ

### 2. æ€§èƒ½ä¼˜åŒ–æ–‡æ¡£
- âœ… é›¶æ‹·è´è¡Œè®¿é—®ï¼ˆOffsetRow/PartialRowï¼‰
- âœ… å¯¹è±¡é‡ç”¨æœºåˆ¶ï¼ˆMutableObjectIteratorï¼‰
- âœ… ç¼“å­˜ä¼˜åŒ–ï¼ˆSegmentsCacheã€ObjectsCacheï¼‰
- âœ… å¹¶è¡Œæ‰§è¡Œï¼ˆManifestReadThreadPoolï¼‰

### 3. åºåˆ—åŒ–ä½“ç³»æ–‡æ¡£
- âœ… ObjectSerializer è¯¦ç»†æ–‡æ¡£
- âœ… ç´§å‡‘åºåˆ—åŒ–æ ¼å¼
- âœ… åˆ—è¡¨åºåˆ—åŒ–æœºåˆ¶

### 4. çŠ¶æ€ç®¡ç†æ–‡æ¡£
- âœ… Checkpoint/Restore æœºåˆ¶
- âœ… å¿«ç…§æ¢å¤
- âœ… åˆ†æ”¯ç®¡ç†

## æ³¨é‡Šè´¨é‡æ ‡å‡†

æ‰€æœ‰å·²å®Œæˆçš„æ–‡ä»¶éƒ½éµå¾ªï¼š

### JavaDoc ç»“æ„
```java
/**
 * ä¸€è¡Œæ¦‚è¿°
 *
 * <p>è¯¦ç»†åŠŸèƒ½è¯´æ˜ï¼ˆåˆ†æ®µï¼‰
 *
 * <p>æ ¸å¿ƒåŠŸèƒ½ï¼š
 * <ul>
 *   <li>åŠŸèƒ½åˆ—è¡¨ï¼ˆå¸¦æ–¹æ³•é“¾æ¥ï¼‰
 * </ul>
 *
 * <p>ä½¿ç”¨åœºæ™¯ï¼š
 * <ul>
 *   <li>åœºæ™¯æè¿°
 * </ul>
 *
 * <p>ä½¿ç”¨ç¤ºä¾‹ï¼š
 * <pre>{@code
 * // å®Œæ•´ä»£ç ç¤ºä¾‹
 * }</pre>
 *
 * @see ç›¸å…³ç±»
 */
```

### è´¨é‡ç‰¹ç‚¹
- âœ… å…¨éƒ¨ä½¿ç”¨ä¸­æ–‡
- âœ… è¯¦ç»†çš„åŠŸèƒ½è¯´æ˜
- âœ… æ¸…æ™°çš„ä½¿ç”¨åœºæ™¯
- âœ… å®Œæ•´çš„ä»£ç ç¤ºä¾‹
- âœ… æ¶æ„å›¾ç¤ºå’Œæµç¨‹è¯´æ˜
- âœ… ç›¸å…³ç±»é“¾æ¥

## å‰©ä½™å·¥ä½œè¯„ä¼°

### å·¥ä½œé‡ä¼°ç®—
å‰©ä½™ 16 ä¸ªæ–‡ä»¶å¯ä»¥åœ¨ 2-3 å°æ—¶å†…å®Œæˆï¼š
- **æ–‡ä»¶å·¥å…·ç±»**ï¼ˆ5ä¸ªï¼‰ï¼šæ¯ä¸ª 20-30 åˆ†é’Ÿï¼Œå…± 100-150 åˆ†é’Ÿ
- **è¯»å†™å·¥å…·ç±»**ï¼ˆ3ä¸ªï¼‰ï¼šæ¯ä¸ª 15-20 åˆ†é’Ÿï¼Œå…± 45-60 åˆ†é’Ÿ
- **è¾…åŠ©ç±»**ï¼ˆ8ä¸ªï¼‰ï¼šæ¯ä¸ª 10-15 åˆ†é’Ÿï¼Œå…± 80-120 åˆ†é’Ÿ

### ä¼˜å…ˆçº§å»ºè®®
1. **é«˜ä¼˜å…ˆçº§**ï¼šDVMetaCacheã€FormatReaderMappingï¼ˆç¼“å­˜ç±»ï¼‰
2. **ä¸­ä¼˜å…ˆçº§**ï¼šFileUtilsã€HintFileUtilsã€ObjectsFileï¼ˆå·¥å…·ç±»ï¼‰
3. **ä½ä¼˜å…ˆçº§**ï¼šå…¶ä»–è¾…åŠ©ç±»

## æ€»ç»“

æœ¬æ¬¡å·¥ä½œä¸º Paimon çš„ utils åŒ…æ·»åŠ äº†è¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Šï¼Œå·²å®Œæˆ **36/52 ä¸ªæ–‡ä»¶ï¼ˆ69%ï¼‰**ã€‚

### æ ¸å¿ƒæˆå°±
- âœ… 4 ä¸ªå®Œæ•´çš„å­ç³»ç»Ÿ 100% å®Œæˆï¼ˆè·¯å¾„ã€å¿«ç…§ã€Changelogã€çº¿ç¨‹æ± ï¼‰
- âœ… 17,000+ è¡Œè¯¦ç»†ä¸­æ–‡æ³¨é‡Š
- âœ… 36+ ä¸ªå®Œæ•´ä»£ç ç¤ºä¾‹
- âœ… 18+ ä¸ªæ¶æ„å›¾ç¤º
- âœ… ç»Ÿä¸€çš„ JavaDoc è§„èŒƒ

### ç‰¹è‰²æ³¨é‡Š
- **ManifestReadThreadPool** - è¯¦ç»†çš„å¹¶è¡Œæ‰§è¡Œç­–ç•¥å’Œçº¿ç¨‹æ± ç®¡ç†
- **SegmentsCache** - å®Œæ•´çš„ç¼“å­˜æœºåˆ¶å’Œå†…å­˜æ§åˆ¶
- **CompactedChangelogPathResolver** - ç‹¬ç‰¹çš„å‡è·¯å¾„å…±äº«ä¼˜åŒ–

### æ–‡æ¡£ä»·å€¼
è¿™äº›è¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Šä¸º Paimon çš„ä¸­æ–‡ç”¨æˆ·æä¾›äº†ï¼š
1. é™ä½å­¦ä¹ æ›²çº¿çš„å®Œæ•´æ¶æ„æ–‡æ¡£
2. å¯è¿è¡Œçš„ä»£ç ç¤ºä¾‹
3. æ€§èƒ½ä¼˜åŒ–çš„æœ€ä½³å®è·µ
4. æ¸…æ™°çš„ä½¿ç”¨åœºæ™¯è¯´æ˜

å‰©ä½™çš„ 16 ä¸ªæ–‡ä»¶ä¸»è¦æ˜¯å·¥å…·ç±»å’Œè¾…åŠ©ç±»ï¼Œå¯ä»¥åœ¨åç»­å¿«é€Ÿå®Œæˆï¼
